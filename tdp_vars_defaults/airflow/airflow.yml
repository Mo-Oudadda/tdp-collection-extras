# Copyright 2022 TOSIT.IO
# SPDX-License-Identifier: Apache-2.0

---
# Airflow Version
airflow_app_name: airflow
airflow_version: 2.2.5

# Airflow users and group
airflow_user: airflow
airflow_group: airflow

# Airflow directories
airflow_root_dir: /opt/tdp
airflow_install_dir: "{{ airflow_root_dir }}/{{ airflow_app_name }}"
airflow_log_dir: /var/log/airflow
airflow_root_conf_dir: /etc/airflow
airflow_pid_dir: /run/airflow
airflow_dag_dir: "{{ airflow_install_dir }}/dags"
airflow_plugins_dir: "{{ airflow_install_dir }}/plugins"
airflow_child_process_log_dir: "{{ airflow_log_dir }}/scheduler"
airflow_certs_dir: "{{ airflow_root_conf_dir }}/certs"

# Airflow Executable:
airflow_executable: /usr/local/bin/airflow

# Airflow database
airflow_db_user: airflow
airflow_db_pass: airflow
airflow_db_host: master-03
airflow_db_port: 5432
airflow_db_name: airflow
airflow_sql_alchemy_conn: "postgresql+psycopg2://{{ airflow_db_user }}:{{ airflow_db_pass }}@{{ airflow_db_host }}:{{ airflow_db_port }}/{{ airflow_db_name }}"

# Airflow admin user
airflow_admin_user: admin
airflow_admin_pass: admin123

# Airflow config
airflow_executor: CeleryExecutor
airflow_result_backend: "db+postgresql://{{ airflow_db_user }}:{{ airflow_db_pass }}@{{ airflow_db_host }}:{{ airflow_db_port }}/{{ airflow_db_name }}"
airflow_broker_url: "redis://master-01:6379/0"

# Required packages
airflow_required_packages:
  - gcc-c++
  - python3-devel.x86_64
  - cyrus-sasl-devel.x86_64
  - krb5-devel

# Python dependencies
airflow_required_python_packages:
  - psycopg2-binary

# SSL configuration
certificates_path: /etc/ssl/certs
certificates_cert_filename: "{{ ansible_fqdn }}"
certificates_ca_filename: "tdp_ca"
certificates_public_key: "{{ certificates_path }}/{{ certificates_cert_filename }}.pem"
certificates_private_key: "{{ certificates_path }}/{{ certificates_cert_filename }}.key"
certificates_ca: "{{ certificates_path }}/{{ certificates_ca_filename }}.crt" 
airflow_public_key: "{{ airflow_certs_dir }}/{{ certificates_cert_filename }}.pem"
airflow_private_key: "{{ airflow_certs_dir }}/{{ certificates_cert_filename }}.key"
ca_certificate_file: "{{ airflow_certs_dir }}/{{ certificates_ca_filename }}.crt"

ssl_certificate: "{{ airflow_public_key }}"
ssl_private_key: "{{ airflow_private_key }}"

# Kerberos
krb_create_principals_keytabs: yes
kerberos:
  airflow_keytab: "/etc/security/keytabs/airflow.service.keytab"
  airflow_principal: "airflow/{{ ansible_fqdn }}@{{ realm }}"
  kinit_path: "/usr/bin/kinit"

# Example DAGs files
airflow_dags_files_path: "files/airflow_example_dags"